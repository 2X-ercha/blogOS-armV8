## GIC内核驱动编写及调用

在实现我们的中断控制器驱动前，首先还是要先了解GIC。由于实验中只需要实现GICv2，故在此只对GICv2进行介绍。

### 中断控制器GICv2

GIC 是联系外设中断和 CPU 的桥梁，也是各 CPU 之间中断互联的通道（也带有管理功能），它负责检测、管理、分发中断，可以做到：

    1、使能或禁止中断；

    2、把中断分组到Group0还是Group1（Group0作为安全模式使用连接FIQ ，Group1 作为非安全模式使用，连接IRQ ）；

    3、多核系统中将中断分配到不同处理器上；

    4、设置电平触发还是边沿触发方式（不等于外设的触发方式）；

    5、虚拟化扩展。

  ARM CPU 对外的连接只有2 个中断： IRQ和FIQ ，相对应的处理模式分别是一般中断（IRQ ）处理模式和快速中断（FIQ ）处理模式。所以GIC 最后要把中断汇集成2 条线，与CPU 对接。

而在我们的实验中无需实现这么多功能。qemu模拟的virt机器作为单核系统，是不需要作过多的考虑的。而虚拟化扩展更非我们需要考虑实现的功能。

在gicv2中，gic由两个大模块`distributor`和`interface`组成：

    1. distributor：主要负责中断源的管理、优先级、中断使能、中断屏蔽等，如下：

        * 中断分发，对于PPI,SGI是各个core独有的中断，不参与目的core的仲裁，SPI，是所有core共享的，根据配置决定中断发往的core。
          
        * 中断优先级的处理，将最高优先级中断发送给cpu interface。
        
        **寄存器使用 GICD_ 作为前缀。一个gic中，只有一个GICD。**  

    2. cpu interface：要用于连接处理器，与处理器进行交互。将GICD发送的中断信息，通过IRQ,FIQ管脚，传输给core。
     
        **寄存器使用 GICC_ 作为前缀。每一个core，有一个cpu interface。**

    3. 另外还有专门服务于虚拟中断的`virtual cpu interface`，这里并不考虑。
